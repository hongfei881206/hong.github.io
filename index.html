<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图片跳转工具</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-5">
    <!-- 管理员按钮 -->
    <button id="adminBtn" class="fixed top-5 right-5 bg-blue-600 text-white px-4 py-2 rounded-md cursor-pointer hover:bg-blue-700 transition">管理员</button>

    <!-- 主展示区域 -->
    <div class="max-w-3xl mx-auto bg-white p-8 rounded-lg shadow-md">
        <!-- 文字显示区 -->
        <div id="textDisplay" class="text-center mb-4 text-2xl text-black">默认展示文字</div>
        <!-- 图片跳转区 -->
        <a id="imageLink" href="https://www.baidu.com" target="_blank" class="block text-center">
            <img id="displayImage" src="https://picsum.photos/600/400" alt="跳转图片" class="mx-auto w-96 h-64 object-cover rounded-md cursor-pointer">
        </a>
    </div>

    <!-- 管理员密码弹窗 -->
    <div id="passwordModal" class="fixed inset-0 bg-black/50 flex items-center justify-center hidden">
        <div class="bg-white p-6 rounded-lg w-80">
            <h3 class="text-xl font-bold mb-4 text-center">管理员验证</h3>
            <input type="password" id="adminPassword" placeholder="输入管理员密码" class="w-full p-2 border border-gray-300 rounded-md mb-4">
            <div class="flex gap-3">
                <button id="verifyBtn" class="flex-1 bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition">验证</button>
                <button id="closePasswordModal" class="flex-1 bg-gray-300 text-black px-4 py-2 rounded-md hover:bg-gray-400 transition">取消</button>
            </div>
            <p id="passwordError" class="text-red-500 text-center mt-3 hidden">密码错误，请重试</p>
        </div>
    </div>

    <!-- 编辑弹窗 -->
    <div id="editModal" class="fixed inset-0 bg-black/50 flex items-center justify-center hidden">
        <div class="bg-white p-6 rounded-lg w-96 max-h-[90vh] overflow-y-auto">
            <h3 class="text-xl font-bold mb-4 text-center">编辑设置</h3>
            
            <!-- 文字设置 -->
            <div class="mb-5">
                <h4 class="font-semibold mb-2">文字设置</h4>
                <input type="text" id="editText" placeholder="输入显示文字" class="w-full p-2 border border-gray-300 rounded-md mb-2">
                <div class="flex gap-2 mb-2">
                    <input type="number" id="fontSize" min="12" max="48" placeholder="字体大小(px)" class="flex-1 p-2 border border-gray-300 rounded-md">
                    <input type="color" id="fontColor" class="w-10 h-10 p-0 border-0 rounded-md">
                </div>
            </div>

            <!-- 图片设置 -->
            <div class="mb-5">
                <h4 class="font-semibold mb-2">图片设置</h4>
                <input type="file" id="imageUpload" accept="image/*" class="w-full p-2 border border-gray-300 rounded-md mb-2">
                <div class="flex gap-2 mb-2">
                    <input type="number" id="imgWidth" min="100" max="800" placeholder="图片宽度(px)" class="flex-1 p-2 border border-gray-300 rounded-md">
                    <input type="number" id="imgHeight" min="100" max="800" placeholder="图片高度(px)" class="flex-1 p-2 border border-gray-300 rounded-md">
                </div>
                <img id="previewImage" alt="预览图片" class="w-full h-40 object-cover rounded-md mb-2 hidden">
            </div>

            <!-- 跳转设置 -->
            <div class="mb-5">
                <h4 class="font-semibold mb-2">跳转设置</h4>
                <input type="url" id="targetUrl" placeholder="输入跳转网址" class="w-full p-2 border border-gray-300 rounded-md">
            </div>

            <!-- 修改密码 -->
            <div class="mb-5 border-t pt-4">
                <h4 class="font-semibold mb-2">修改密码</h4>
                <input type="password" id="oldPwd" placeholder="输入旧密码" class="w-full p-2 border border-gray-300 rounded-md mb-2">
                <input type="password" id="newPwd" placeholder="输入新密码(≥6位)" class="w-full p-2 border border-gray-300 rounded-md mb-2">
                <input type="password" id="confirmPwd" placeholder="确认新密码" class="w-full p-2 border border-gray-300 rounded-md">
                <p id="pwdError" class="text-red-500 text-sm mt-2 hidden">密码不一致或旧密码错误</p>
                <p id="pwdSuccess" class="text-green-500 text-sm mt-2 hidden">密码修改成功</p>
            </div>

            <div class="flex gap-3">
                <button id="saveBtn" class="flex-1 bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition">保存设置</button>
                <button id="closeEditModal" class="flex-1 bg-gray-300 text-black px-4 py-2 rounded-md hover:bg-gray-400 transition">取消</button>
            </div>
        </div>
    </div>

    <script>
        // 初始数据（本地存储）
        let appData = JSON.parse(localStorage.getItem('imageLinkApp')) || {
            text: '默认展示文字',
            fontSize: 24,
            fontColor: '#000000',
            imageUrl: 'https://picsum.photos/600/400',
            imgWidth: 600,
            imgHeight: 400,
            targetUrl: 'https://www.baidu.com',
            password: 'admin123'
        };

        // DOM元素
        const adminBtn = document.getElementById('adminBtn');
        const passwordModal = document.getElementById('passwordModal');
        const editModal = document.getElementById('editModal');
        const verifyBtn = document.getElementById('verifyBtn');
        const closePasswordModal = document.getElementById('closePasswordModal');
        const closeEditModal = document.getElementById('closeEditModal');
        const saveBtn = document.getElementById('saveBtn');
        const adminPassword = document.getElementById('adminPassword');
        const passwordError = document.getElementById('passwordError');
        const textDisplay = document.getElementById('textDisplay');
        const displayImage = document.getElementById('displayImage');
        const imageLink = document.getElementById('imageLink');
        const editText = document.getElementById('editText');
        const fontSize = document.getElementById('fontSize');
        const fontColor = document.getElementById('fontColor');
        const imageUpload = document.getElementById('imageUpload');
        const imgWidth = document.getElementById('imgWidth');
        const imgHeight = document.getElementById('imgHeight');
        const previewImage = document.getElementById('previewImage');
        const targetUrl = document.getElementById('targetUrl');
        const oldPwd = document.getElementById('oldPwd');
        const newPwd = document.getElementById('newPwd');
        const confirmPwd = document.getElementById('confirmPwd');
        const pwdError = document.getElementById('pwdError');
        const pwdSuccess = document.getElementById('pwdSuccess');

        // 初始化页面
        function initPage() {
            textDisplay.textContent = appData.text;
            textDisplay.style.fontSize = `${appData.fontSize}px`;
            textDisplay.style.color = appData.fontColor;
            displayImage.src = appData.imageUrl;
            displayImage.style.width = `${appData.imgWidth}px`;
            displayImage.style.height = `${appData.imgHeight}px`;
            imageLink.href = appData.targetUrl;
        }

        // 初始化编辑表单
        function initEditForm() {
            editText.value = appData.text;
            fontSize.value = appData.fontSize;
            fontColor.value = appData.fontColor;
            imgWidth.value = appData.imgWidth;
            imgHeight.value = appData.imgHeight;
            targetUrl.value = appData.targetUrl;
            previewImage.src = appData.imageUrl;
            previewImage.classList.remove('hidden');
            // 重置密码相关
            oldPwd.value = '';
            newPwd.value = '';
            confirmPwd.value = '';
            pwdError.classList.add('hidden');
            pwdSuccess.classList.add('hidden');
        }

        // 保存数据到本地存储
        function saveData() {
            localStorage.setItem('imageLinkApp', JSON.stringify(appData));
        }

        // 事件监听
        adminBtn.addEventListener('click', () => {
            passwordModal.classList.remove('hidden');
            adminPassword.value = '';
            passwordError.classList.add('hidden');
        });

        closePasswordModal.addEventListener('click', () => {
            passwordModal.classList.add('hidden');
        });

        closeEditModal.addEventListener('click', () => {
            editModal.classList.add('hidden');
        });

        // 密码验证
        verifyBtn.addEventListener('click', () => {
            if (adminPassword.value === appData.password) {
                passwordModal.classList.add('hidden');
                editModal.classList.remove('hidden');
                initEditForm();
            } else {
                passwordError.classList.remove('hidden');
            }
        });

        // 图片上传预览
        imageUpload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    previewImage.src = event.target.result;
                    previewImage.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        });

        // 保存设置
        saveBtn.addEventListener('click', () => {
            // 更新基础设置
            appData.text = editText.value.trim() || appData.text;
            appData.fontSize = parseInt(fontSize.value) || appData.fontSize;
            appData.fontColor = fontColor.value || appData.fontColor;
            appData.imgWidth = parseInt(imgWidth.value) || appData.imgWidth;
            appData.imgHeight = parseInt(imgHeight.value) || appData.imgHeight;
            appData.targetUrl = targetUrl.value.trim() || appData.targetUrl;

            // 更新图片（如果有新上传）
            if (previewImage.src !== appData.imageUrl && previewImage.src) {
                appData.imageUrl = previewImage.src;
            }

            // 处理密码修改
            if (oldPwd.value) {
                if (oldPwd.value !== appData.password) {
                    pwdError.classList.remove('hidden');
                    pwdSuccess.classList.add('hidden');
                    return;
                }
                if (newPwd.value !== confirmPwd.value || newPwd.value.length < 6) {
                    pwdError.classList.remove('hidden');
                    pwdSuccess.classList.add('hidden');
                    return;
                }
                appData.password = newPwd.value;
                pwdSuccess.classList.remove('hidden');
                pwdError.classList.add('hidden');
            }

            // 保存并刷新页面
            saveData();
            initPage();
            setTimeout(() => {
                editModal.classList.add('hidden');
            }, 1000);
        });

        // 初始化
        initPage();
    </script>
</body>
</html>